CREATE OR REPLACE TRIGGER TRG_VERIFICAR_WILDCARD_1
FOR INSERT OR UPDATE ON EQUIPOS_JUGADORES
COMPOUND TRIGGER

  -- Declarar variables globales para el trigger
  CANT_WILDCARDS NUMBER(2);
  CANT_HABITUALES NUMBER;
  NEW_TIPO_JUGADOR VARCHAR(20);

BEFORE EACH ROW IS
BEGIN

  --SELECT DE LA CANTIDAD DE JUGADORES DE TIPO WILDCARD EN EL EQUIPO QUE SE QUIERE INSERTAR, METEMOS EL RESULTADO EN LA VARIABLE CANT_WILDCARDS.
  SELECT COUNT(*) INTO CANT_WILDCARDS FROM EQUIPOS_JUGADORES
    WHERE ID_EQUIPO = :NEW.ID_EQUIPO AND ID_JUGADOR IN (SELECT ID_JUGADOR FROM JUGADORES WHERE TIPO_JUGADOR = 'WILDCARD');
    
  SELECT COUNT(*) INTO CANT_HABITUALES FROM EQUIPOS_JUGADORES
    WHERE ID_EQUIPO = :NEW.ID_EQUIPO AND ID_JUGADOR IN (SELECT ID_JUGADOR FROM JUGADORES WHERE TIPO_JUGADOR = 'HABITUAL');
    
  SELECT TIPO_JUGADOR INTO NEW_TIPO_JUGADOR FROM JUGADORES WHERE ID_JUGADOR = :NEW.ID_JUGADOR; 
  --SI LA VARIABLE ES =2 Y EL TIPO DE JUGADOR ES WILDCARD SACAMOS UN ERROR POR PANTALLA.
END BEFORE EACH ROW;
AFTER EACH ROW IS
BEGIN
    IF NEW_TIPO_JUGADOR = 'WILDCARD' THEN
        IF CANT_WILDCARDS = 2 THEN
            RAISE_APPLICATION_ERROR(-20001, 'NO SE PUEDEN TENER MAS DE 2 JUGADORES DE TIPO WILDCARD');
        END IF;
    ELSE
        IF CANT_HABITUALES = 8 THEN
            RAISE_APPLICATION_ERROR(-20001, 'NO SE PUEDEN TENER MAS DE 8 JUGADORES DE TIPO HABITUAL');
        END IF;
    END IF;
END AFTER EACH ROW;  
END TRG_VERIFICAR_WILDCARD_1;